<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>Centos7.9æ­å»ºå’Œä½¿ç”¨Kubernetes | haotchen</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="http://ggcodec.github.io/favicon.ico?v=1677422907614">
<link rel="stylesheet" href="http://ggcodec.github.io/styles/main.css">


  
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css" />
  

  


<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>



    <meta name="description" content="ğŸ’¡ æŒ‰ç…§æœ¬æ–‡æ¡£å¯ä»¥å¿«é€Ÿæ­å»ºå­¦ä¹ ç¯å¢ƒä¸‹çš„Kubenetesé›†ç¾¤
ğŸ˜ å¯¹è¯¥åº”ç”¨è¿›è¡Œå­¦ä¹ å’Œåˆæ­¥äº†è§£,é«˜æ•ˆå­¦ä¹ ä»æˆ‘åšèµ·

1. k8sç®€ä»‹:
Kubernetes(k8s)æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿæ”¯æ’‘å¹³å°,ä¹Ÿå«å®¹å™¨ç¼–æ’å¼•æ“,å…·æœ‰å®Œå¤‡çš„é›†ç¾¤ç®¡ç†èƒ½åŠ›,å¤šå±‚..." />
    <meta name="keywords" content="è¿ç»´" />
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="http://ggcodec.github.io">
        <img src="http://ggcodec.github.io/images/avatar.png?v=1677422907614" class="site-logo">
        <h1 class="site-title">haotchen</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            é¦–é¡µ
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            å½’æ¡£
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            æ ‡ç­¾
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            å…³äº
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
          <a class="social-link" href="https://www.github.com/ggcodec/ggcodec.github.io" target="_blank">
            <i class="fab fa-github"></i>
          </a>
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      <h4>å­¦ä¹ å†…å®¹ä¸€ç‚¹ä¸€æ»´,æ¸©æ•…è€ŒçŸ¥æ–°</h4>

    </div>
    <div class="site-footer">
      Powered by <a href="https://github.com/ggcodec/ggcodec.github.io" target="_blank">haotchen@ggcodec</a> | <a class="rss" href="http://ggcodec.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">Centos7.9æ­å»ºå’Œä½¿ç”¨Kubernetes</h2>
            <div class="post-date">2023-02-26</div>
            
              <div class="feature-container" style="background-image: url('http://ggcodec.github.io/post-images/centos79-da-jian-he-shi-yong-kubernetes.png')">
              </div>
            
            <div class="post-content" v-pre>
              <p>ğŸ’¡ æŒ‰ç…§æœ¬æ–‡æ¡£å¯ä»¥å¿«é€Ÿæ­å»ºå­¦ä¹ ç¯å¢ƒä¸‹çš„Kubenetesé›†ç¾¤<br>
ğŸ˜ å¯¹è¯¥åº”ç”¨è¿›è¡Œå­¦ä¹ å’Œåˆæ­¥äº†è§£,é«˜æ•ˆå­¦ä¹ ä»æˆ‘åšèµ·</p>
<!-- more -->
<h2 id="1-k8sç®€ä»‹">1. k8sç®€ä»‹:</h2>
<p>Kubernetes(k8s)æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿæ”¯æ’‘å¹³å°,ä¹Ÿå«å®¹å™¨ç¼–æ’å¼•æ“,å…·æœ‰å®Œå¤‡çš„é›†ç¾¤ç®¡ç†èƒ½åŠ›,å¤šå±‚æ¬¡çš„å®‰å…¨é˜²æŠ¤å’Œå‡†å…¥æœºåˆ¶.</p>
<p>Kubernetes ç‰¹æ€§</p>
<ul>
<li>
<p>è‡ªåŠ¨è£…ç®±</p>
<p>æ„å»ºäºå®¹å™¨ä¹‹ä¸Šï¼ŒåŸºäºèµ„æºä¾èµ–åŠå…¶ä»–çº¦æŸè‡ªåŠ¨å®Œæˆå®¹å™¨éƒ¨ç½²ä¸”ä¸å½±å“å…¶å¯ç”¨æ€§ï¼Œå¹¶é€šè¿‡è°ƒåº¦æœºåˆ¶ä½¿å·¥ä½œè´Ÿ è½½äºä¸åŒèŠ‚ç‚¹ä»¥æå‡èµ„æºåˆ©ç”¨ç‡ã€‚</p>
</li>
<li>
<p>è‡ªæˆ‘ä¿®å¤</p>
<p>æ”¯æŒå®¹å™¨æ•…éšœåè‡ªåŠ¨é‡å¯ï¼ŒèŠ‚ç‚¹æ•…éšœåé‡æ–°è°ƒåº¦å®¹å™¨ï¼Œä»¥åŠå…¶ä»–å¯ç”¨èŠ‚ç‚¹ï¼Œå¥åº·çŠ¶æ€æ£€æŸ¥å¤±è´¥åå…³é—­å®¹å™¨å¹¶ é‡æ–°åˆ›å»ºç­‰è‡ªæˆ‘ä¿®å¤æœºåˆ¶ã€‚</p>
</li>
<li>
<p>æ°´å¹³æ‰©å±•</p>
<p>æ”¯æŒé€šè¿‡ç®€å•å‘½ä»¤æˆ–UIæ‰‹åŠ¨æ°´å¹³æ‰©å±•ï¼Œä»¥åŠåŸºäºCPUç­‰èµ„æºè´Ÿè½½ç‡çš„è‡ªåŠ¨æ°´å¹³æ‰©å±•æœºåˆ¶ã€‚</p>
</li>
<li>
<p>æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡</p>
<p>Kubemetesé€šè¿‡å…¶é™„åŠ ç»„ä»¶ä¹‹ä¸€çš„KubeDNSä¸ºç³»ç»Ÿå†…ç½®äº†æœåŠ¡å‘ç°åŠŸèƒ½ï¼Œå®ƒä¼šä¸ºæ¯ä¸ªServiceé…ç½®DNSæœ åŠ¡ï¼Œå¹¶å…è®¸é›†ç¾¤å†…çš„å®¢æˆ·ç«¯ç›´æ¥ä½¿ç”¨æ­¤åç§°å‘å‡ºè®¿é—®è¯·æ±‚ã€‚</p>
</li>
<li>
<p>è‡ªåŠ¨å‘å¸ƒå’Œå›æ»š</p>
<p>Kubemetesæ”¯æŒã€ƒç°åº¦ã€ƒæ›´æ–°åº”ç”¨ç¨‹åºæˆ–å…¶é…ç½®ä¿¡æ¯ï¼Œå®ƒä¼šé›Œæ›´æ–°è¿‡ç¨‹ä¸­åº”ç”¨ç¨‹åºçš„å¥åº·çŠ¶æ€ï¼Œä»¥ç¡®ä¿å®ƒä¸ ä¼šåœ¨åŒä¸€æ—¶åˆ»æ€æ‰æ‰€æœ‰å®ä¾‹ï¼Œè€Œæ­¤è¿‡ç¨‹ä¸­ä¸€æ—¦æœ‰æ•…éšœå‘ç”Ÿï¼Œå°±ä¼šç«‹å³è‡ªåŠ¨æ‰§è¡Œå›æ»šæ“ä½œã€‚</p>
</li>
<li>
<p>å­˜å‚¨ç¼–æ’</p>
<p>Kubernetesæ”¯æŒPodå¯¹è±¡æŒ‰éœ€è‡ªåŠ¨æŒ‚è½½ä¸åŒç±»å‹çš„å­˜å‚¨ç³»ç»Ÿï¼ŒåŒ…æ‹¬èŠ‚ç‚¹æœ¬åœ°å­˜å‚¨ï¼Œäº‘å­˜å‚¨ç­‰ã€‚</p>
</li>
<li>
<p>æ‰¹é‡å¤„ç†æ‰§è¡Œ</p>
<p>é™¤äº†æœåŠ¡å‹åº”ç”¨ï¼ŒKubernetesè¿˜æ”¯æŒæ‰¹é‡å¤„ç†ä½œä¸šï¼Œå¦‚æœéœ€è¦ï¼Œä¸€æ ·å¯ä»¥å®ç°å®¹å™¨æ•…éšœåå›å¤ã€‚</p>
</li>
</ul>
<h2 id="2-ç»„ä»¶ä»‹ç»">2. ç»„ä»¶ä»‹ç»</h2>
<ol>
<li>
<p>Master</p>
<blockquote>
<p>Master èŠ‚ç‚¹ç”¨äºç®¡ç†å’Œè°ƒåº¦NodeèŠ‚ç‚¹,å¯ä»¥ç†è§£ä¸ºè¯¥èŠ‚ç‚¹åªè´Ÿè´£ç®¡ç†ä¸çœŸå®å¹²æ´».</p>
</blockquote>
<ul>
<li>
<p>API Server: è´Ÿè´£è¾“å‡ºRestFulé£æ ¼çš„Kubernetes API, ä»–æ˜¯å‘ç½‘é›†ç¾¤çš„æ‰€æœ‰restæ“ä½œå‘½ä»¤çš„æ¥å£,å¹¶è´Ÿè´£æ¥å—,æ ¡éªŒå’Œå“åº”æ‰€æœ‰RESTè¯·æ±‚,ç»“æœçŠ¶æ€è¢«æŒä¹…å­˜å‚¨åœ¨ETCDä¸­,å› æ­¤,APIServerä½¿æ•´ä¸ªé›†ç¾¤çš„ç½‘å…³.</p>
</li>
<li>
<p>ETCD: k8sé›†ç¾¤çš„æ‰€æœ‰çŠ¶æ€ä¿¡æ¯éƒ½éœ€è¦æŒä¹…å­˜å‚¨åˆ°etcdä¸­,ä¸è¿‡,etcdæ˜¯ç”±åŸºäºRAFåè®®å¼€å‘çš„åˆ†å¸ƒå¼å…¼èŒå­˜å‚¨,å¯ä»¥ç”¨äºæœåŠ¡å‘ç°,å…±äº«é…ç½®åŠä¸€è‡´æ€§ä¿éšœ(å¦‚æ•°æ®åº“ä¸»èŠ‚ç‚¹é€‰æ‹©,åˆ†å¸ƒå¼é”ç­‰). å› æ­¤,etcdæ˜¯ç‹¬ç«‹çš„æœåŠ¡ç»„ä»¶å¹¶ä¸å±äºk8sé›†ç¾¤è‡ªèº«,ç”Ÿäº§ç¯å¢ƒä¸­åº”è¯¥ä»¥etcdé›†ç¾¤çš„æ–¹å¼è¿è¡Œç¡®ä¿å…¶å¯ç”¨æ€§.</p>
<p>etcd ä¸ä»…èƒ½å¤Ÿæä¾›é”®å€¼æ•°æ®å­˜å‚¨,è¿˜æä¾›äº†ç›‘å¬æœºåˆ¶,ç”¨äºç›‘å¬å’Œæ¨é€å˜æ›´,Kubernetesé›†ç¾¤ç³»ç»Ÿä¸­,etcdä¸­çš„é”®å€¼å‘ç”Ÿå˜åŒ–æ—¶ä¼šé€šçŸ¥åˆ°API Server,å¹¶ç”±å…¶é€šè¿‡watch API å‘å®¢æˆ·ç«¯è¾“å‡º,åŸºäºwatchæœºåˆ¶ k8s é›†ç¾¤çš„å„ä¸ªç»„ä»¶å®ç°äº†é«˜æ•ˆååŒ</p>
</li>
<li>
<p>kube-controller-manager: k8sä¸­æ§åˆ¶å™¨ç®¡ç†å™¨,é›†ç¾¤çº§åˆ«çš„å¤§å¤šæ•°åŠŸèƒ½éƒ½æ˜¯ç”±å‡ ä¸ªè¢«ç§°ä¸ºæ§åˆ¶å™¨çš„è¿›ç¨‹æ‰§è¡Œå®ç°çš„,è¿™å‡ ä¸ªè¿›ç¨‹è¢«é›†æˆäºkube-controller-manager å®ˆæŠ¤è¿›ç¨‹ä¸­,ç”±æ§åˆ¶å™¨å®Œæˆçš„åŠŸèƒ½ä¸»è¦åŒ…æ‹¬ç”Ÿå‘½å‘¨æœŸå’ŒAPIä¸šåŠ¡é€»è¾‘</p>
</li>
<li>
<p>Schedule: k8sé€‚ç”¨äºéƒ¨ç½²å’Œç®¡ç†å¤§è§„æ¨¡å®¹å™¨åº”ç”¨çš„å¹³å°,æ ¹æ®é›†ç¾¤è§„æ¨¡çš„ä¸åŒ,å…¶æ‰˜ç®¡è¿è¡Œçš„å®¹å™¨å¾ˆå¯èƒ½ä¼šæ•°ä»¥åƒè®¡,ç”šè‡³æ›´å¤š,æ‰€ä»¥åœ¨API Serverç¡®è®¤Podå¯¹è±¡çš„åˆ›å»ºè¯·æ±‚å,ä¾¿éœ€è¦ç”±Scheduleæ ¹æ®é›†ç¾¤å†…èŠ‚ç‚¹çš„å¯ç”¨èµ„æºçŠ¶æ€,ä»¥åŠè¿è¡Œçš„å®¹å™¨èµ„æºéœ€æ±‚åšå‡ºè°ƒåº¦å†³ç­–.</p>
</li>
</ul>
</li>
<li>
<p>Node</p>
<blockquote>
<p>Node èŠ‚ç‚¹è´Ÿè´£æä¾›è¿è¡Œå®¹å™¨çš„å„ç§ä¾èµ–ç¯å¢ƒ,å¹¶æ¥å—Masterç®¡ç†,æ¯ä¸ªNodeä¸»è¦ç”±ä»¥ä¸‹çš„å‡ ä¸ªç»„ä»¶ç»„æˆ</p>
</blockquote>
<ul>
<li>kubelet: è¯¥ç»„ä»¶æ˜¯è¿è¡Œåœ¨èŠ‚ç‚¹ä¸Šçš„å®ˆæŠ¤è¿›ç¨‹,ä»–ä»API Server æ¥æ”¶å…³äºPodå¯¹è±¡çš„é…ç½®æ–°å¹¶ç¡®ä¿ä»–ä»¬å¤„äºæœŸæœ›çš„çŠ¶æ€æ ¹æ®Podå¯¹è±¡çš„é…ç½®æ›´æ–°Podèµ„æº,å¦‚Podé…ç½®3å°nginxå®¹å™¨,å½“å‰Podä¸­åªæœ‰1ä¸ª,é‚£Kubeletä¼šåˆ›å»ºè¡¥é½ç›´åˆ°ç¬¦åˆé…ç½®,Kubeletä¼šåœ¨ApiServerä¸Šæ³¨å†Œå½“å‰å·¥ä½œèŠ‚ç‚¹,å®šæœŸå‘Masteræ±‡æŠ¥èŠ‚ç‚¹èµ„æºä½¿ç”¨æƒ…å†µ,å¹¶ç›‘æ§å®¹å™¨å’ŒèŠ‚ç‚¹èµ„æºçš„å ç”¨çŠ¶å†µ.</li>
<li>å®¹å™¨è¿è¡Œæ—¶ç¯å¢ƒ: æ˜¯æŒ‡k8sé›†ç¾¤ä¸­ä½¿ç”¨çš„å®¹å™¨æŠ€æœ¯,å¦‚(Docker...)</li>
<li>kube-proxy: æ¯ä¸ªå·¥ä½œèŠ‚ç‚¹éƒ½éœ€è¦è¿è¡Œä¸€ä¸ª, å®ƒèƒ½å¤ŸæŒ‰éœ€å–‚Serviceèµ„æºå¯¹è±¡ç”Ÿæˆiptablesæˆ–ipvsè§„åˆ™,ä»è€Œæ•è·è®¿é—®å½“å‰Serviceçš„Clusterçš„æµé‡å¹¶å°†å…¶è½¬å‘è‡³æ­£ç¡®çš„æœåŠ¡</li>
</ul>
</li>
<li>
<p>K8sæ ¸å¿ƒå¯¹è±¡</p>
<table>
<thead>
<tr>
<th>å¯¹è±¡åç§°</th>
<th>å¯¹è±¡æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>Pod</td>
<td>Podèµ„æºå¯¹è±¡æ˜¯ä¸€ç§é›†åˆäº†<strong>å¤šä¸ªåº”ç”¨å®¹å™¨çš„ç®¡ç†å•å…ƒ</strong>,å°†æœ‰å…³è”çš„å®¹å™¨æœåŠ¡æ”¾å…¥ä¸€ä¸ªPodæ–¹ä¾¿ç½‘ç»œé€šä¿¡å’Œæ‰©å±•ä¼¸ç¼©</td>
</tr>
<tr>
<td>Controller</td>
<td>Controller Manager ä½œä¸ºé›†ç¾¤å†…éƒ¨çš„ç®¡ç†æ§åˆ¶ä¸­å¿ƒ,è´Ÿè´£é›†ç¾¤å†…çš„Node,Podå‰¯æœ¬,æœåŠ¡ç«¯ç‚¹,å‘½åç©ºé—´,æœåŠ¡è´¦å·,èµ„æºå®šé¢çš„ç®¡ç†,å½“æŸä¸ªNodeæ„å¤–å®•æœº,Controller Manager ä¼šåŠæ—¶å‘ç°å¹¶æ‰§è¡Œè‡ªåŠ¨åŒ–ä¿®å¤æµç¨‹,ç¡®ä¿é›†ç¾¤å§‹ç»ˆå¤„äºé¢„æœŸçš„å·¥ä½œçŠ¶æ€,Controlleré€šè¿‡ApiServer æä¾›çš„æ¥å£å®æ—¶ç›‘æ§æ•´ä¸ªé›†ç¾¤çš„Podå¯¹è±¡çŠ¶æ€,å½“å‘ç”Ÿå„ç§æ•…éšœå¯¼è‡´ç³»ç»ŸçŠ¶æ€å¼‚å¸¸æ—¶,ä¼šå°è¯•ç³»ç»ŸçŠ¶æ€ä¿®å¤åˆ°æœŸæœ›çŠ¶æ€</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<ul>
<li>
<p>Podç‰¹ç‚¹:</p>
<pre><code>1. å¯ç®¡ç†æ€§:
	æœ‰äº›å®¹å™¨å¤©ç”Ÿå°±æ˜¯éœ€è¦ç´§å¯†è”ç³»,å¦‚javaå¼€å‘çš„å¾®æœåŠ¡æ¨¡å—éœ€è¦ç‹¬ç«‹éƒ¨ç½²ä½†æ˜¯,è¿™äº›æ¨¡å—ä¹‹é—´éœ€è¦äº’ç›¸é€šä¿¡è°ƒç”¨,æ”¾åœ¨åŒä¸€ä¸ªPodä¸­,ç›¸å½“äºåšäº†ä¸ªåˆ†ç»„æ˜“äºç®¡ç†.
2. é€šä¿¡å’Œèµ„æºå…±äº«:
	Podä¸­çš„æ‰€æœ‰å®¹å™¨ä½¿ç”¨åŒä¸€ä¸ªç½‘ç»œ NameSpace ,å³ç›¸åŒçš„Ipåœ°å€å’ŒPortç©ºé—´(åœ°å€å¯ä»¥ç›¸åŒportä¸èƒ½å†²çª),å®ƒä»¬å¯ä»¥ç›´æ¥é€šè¿‡loaclhost é€šä¿¡,å¹¶ä¸”å½“k8sä¸ºPodæŒ‚åœ¨volumeæ—¶,æœ¬è´¨ä¸Šæ˜¯å¯¹podä¸­çš„æ‰€æœ‰å®¹å™¨æŒ‚åœ¨volume
</code></pre>
</li>
<li>
<p>Podä½¿ç”¨æ–¹å¼:</p>
<ul>
<li>è¿è¡Œå•ä¸€å®¹å™¨: <code>one-container-per-Pod</code> æ˜¯k8så¸¸è§çš„æ¨¡å‹</li>
<li>è¿è¡Œå¤šä¸ªå®¹å™¨: é—®é¢˜åœ¨äºé‚£äº›å®¹å™¨åº”è¯¥æ”¾åˆ°ä¸€ä¸ªPodä¸­,å®¹å™¨è”ç³»å¾ˆç´§å¯†æˆ–è€…éœ€è¦å¤šä¸ªå…±äº«èµ„æºçš„</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="3-k8sé›†ç¾¤æ­å»º">3. K8sé›†ç¾¤æ­å»º</h2>
<p>é›†ç¾¤ç±»å‹:</p>
<table>
<thead>
<tr>
<th>é›†ç¾¤ç±»å‹</th>
<th style="text-align:center">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>ä¸€ä¸»å¤šä»</td>
<td style="text-align:center">ä¸€å°MasterèŠ‚ç‚¹å’Œå¤šå°NodeèŠ‚ç‚¹,æ­å»ºç®€å•,ä½†æ˜¯æœ‰å•æœºæ•…éšœé£é™©,é€‚ç”¨äºæµ‹è¯•ç¯å¢ƒ</td>
</tr>
<tr>
<td>å¤šä¸»å¤šä»</td>
<td style="text-align:center">å¤šå°MasterèŠ‚ç‚¹å’Œå¤šå°NodeèŠ‚ç‚¹,æ­å»ºéº»çƒ¦,ä¿éšœé«˜å¯ç”¨,é€‚ç”¨äºç”Ÿäº§ç¯å¢ƒ</td>
</tr>
</tbody>
</table>
<p>å®‰è£…æ–¹å¼:</p>
<table>
<thead>
<tr>
<th style="text-align:center">å®‰è£…æ–¹å¼</th>
<th>ä»‹ç»</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">minikube</td>
<td>ä¸€ä¸ªç”¨äºå¿«é€Ÿæ­å»ºå•èŠ‚ç‚¹Kubenetesçš„å·¥å…·</td>
</tr>
<tr>
<td style="text-align:center"><strong style="color:red;">kubeadm</strong></td>
<td>ä¸€ä¸ªç”¨äºå¿«é€Ÿæ­å»ºKubenetesé›†ç¾¤çš„å·¥å…·(æœ¬æ¬¡å®‰è£…æ–¹å¼)</td>
</tr>
<tr>
<td style="text-align:center">äºŒè¿›åˆ¶åŒ…</td>
<td>ä»å®˜ç½‘ä¸‹è½½æ¯ä¸ªç»„ä»¶çš„äºŒè¿›åˆ¶åŒ…,ä¾æ¬¡å»å®‰è£…,æ­¤æ–¹å¼å¯¹äºç†è§£Kubenetesç»„ä»¶æ›´åŠ æœ‰æ•ˆ</td>
</tr>
<tr>
<td style="text-align:center">kubeKey</td>
<td>KubeSphereæä¾›çš„å¿«é€Ÿæ­å»ºKubenetesé›†ç¾¤çš„å·¥å…·,å¹¶ä¸”å¿«é€Ÿéƒ¨ç½²KubeSphere</td>
</tr>
</tbody>
</table>
<blockquote>
<p>æœ¬æ¬¡é‡‡ç”¨Kubeadm æ–¹å¼æ­å»ºé›†ç¾¤</p>
</blockquote>
<h4 id="1-ç³»ç»Ÿåˆå§‹åŒ–">1) ç³»ç»Ÿåˆå§‹åŒ–</h4>
<ol>
<li>
<p>å‰ç½®å‡†å¤‡3 å°Linuxæœºå™¨ ç³»ç»Ÿé•œåƒ(<a href="https://mirrors.aliyun.com/centos/7/isos/x86_64/CentOS-7-x86_64-DVD-2009.iso?spm=a2c6h.25603864.0.0.159f2d1cXqZu0H">ctrl + ç‚¹å‡»ğŸ‘‡ä¸‹è½½CentOS-7-x86_64-DVD-2009</a>)</p>
</li>
<li>
<p>æœºå™¨è§„æ ¼: 2C2G(æœ€ä½é…ç½®)</p>
<blockquote>
<p>å®‰è£…VMwareåå®‰è£…3å°Linux,å‚è€ƒç½‘ä¸Šå…¶ä»–æ•™ç¨‹.</p>
</blockquote>
</li>
</ol>
<h4 id="2-æœºå™¨å‘½å">2) æœºå™¨å‘½å</h4>
<p><strong>é‡è¦: åç»­æ–‡ç« ä¸­åªä¼šæåŠåç§°. æ³¨æ„åŒºåˆ†</strong></p>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>IPåœ°å€(æ ¹æ®è‡ªå·±å®æ™¯æƒ…å†µé…ç½®åœ°å€å³å¯)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Master</td>
<td>192.168.140.132</td>
</tr>
<tr>
<td>Node1</td>
<td>...133</td>
</tr>
<tr>
<td>Node2</td>
<td>...134</td>
</tr>
</tbody>
</table>
<p>é™æ€é…ç½®æ¨¡ç‰ˆ</p>
<p><code>vim /etc/sysconfig/network-scripts/ifcfg-ens33</code></p>
<pre><code># æ›¿æ¢
BOOTPROTO=&quot;dhcp&quot; =&gt; BOOTPROTO=&quot;static&quot;

# æ–‡ä»¶å†…æ–°å¢
IPADDR=æ ¹æ®å®é™…æƒ…å†µåˆ¶å®š
GATEWAY=192.168.140.2
NETMASK=255.255.255.0
DNS1=192.168.140.2
</code></pre>
<p>æµ‹è¯•ç½‘ç»œæ˜¯å¦é€šç•….å¾—åˆ°å¦‚ä¸‹ç»“æœè¡¨ç¤ºæœºå™¨ç½‘ç»œé€šç•…</p>
<pre><code>[root@localhost ~]# ping www.baidu.com
PING www.a.shifen.com (14.215.177.38) 56(84) bytes of data.
64 bytes from 14.215.177.38 (14.215.177.38): icmp_seq=1 ttl=128 time=9.29 ms
64 bytes from 14.215.177.38 (14.215.177.38): icmp_seq=2 ttl=128 time=10.1 ms
</code></pre>
<h4 id="3-ä¸»æœºåç§°è§£æ">3) ä¸»æœºåç§°è§£æ</h4>
<blockquote>
<p>æµ‹è¯•ç¯å¢ƒä¸‹å‘3å°ä¸»æœºè¿½åŠ hostsè§£æ,</p>
<p>ç”Ÿäº§ç¯å¢ƒä¼šæ­å»ºDNSæœåŠ¡å™¨,ä¸ä¼šæ‰‹åŠ¨ä¿®æ”¹hostsæ–‡ä»¶</p>
</blockquote>
<pre><code class="language-shell">cat &lt;&lt; EOF &gt;&gt;/etc/hosts
192.168.140.132 master
192.168.140.133 node1
192.168.140.134 node2
EOF

# ä¸‰å°æœºå™¨ä¸Šåˆ†å¼€æ‰§è¡Œ
echo &quot;master&quot; &gt; /etc/hostname
echo &quot;node1&quot; &gt; /etc/hostname
echo &quot;node2&quot; &gt; /etc/hostname
</code></pre>
<h4 id="4-é…ç½®é˜¿é‡Œäº‘yumæº">4) é…ç½®é˜¿é‡Œäº‘yumæº</h4>
<blockquote>
<p>3å°æœºå™¨éƒ½è¦æ‰§è¡Œçš„,æ³¨æ„æœ¬æ¬¡æ‰€æœ‰æ“ä½œéƒ½æ˜¯åœ¨rootè´¦å·ä¸‹æ‰§è¡Œ. è‹¥ä¸æ˜¯root å»ºè®®æ‰€æœ‰æ“ä½œå‰sudo æˆæƒæ‰§è¡Œ,å¦åˆ™ä¼šæŠ¥å‡ºæ„æƒ³ä¸åˆ°çš„é”™è¯¯.</p>
<p>æ‰§è¡Œå‰è¯·æ³¨æ„è‡ªè¡Œå¤‡ä»½repoæ–‡ä»¶</p>
</blockquote>
<p>ç¼–å†™é…ç½®é˜¿é‡Œäº‘yumæºæ–‡ä»¶è„šæœ¬</p>
<pre><code class="language-shell">cat &lt;&lt; EOF &gt; temp_init.sh
# å¤‡ä»½ç³»ç»ŸåŸæœ‰çš„repo æ–‡ä»¶.
mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.bak

# ä¸‹è½½é˜¿é‡Œäº‘repoæ–‡ä»¶
curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo

# é‡å»ºç¼“å­˜
yum clean all
yum makecache

yum -y install vim
if [[ $? -eq 0 ]];then
echo &quot;vim ç¼–è¾‘å™¨å®‰è£…æˆåŠŸ&quot;
fi
EOF
</code></pre>
<p>æ‰§è¡Œè„šæœ¬</p>
<pre><code class="language-shell">. temp_init.sh
</code></pre>
<h4 id="5-æ‰€æœ‰æœºå™¨å®‰è£…docker">5) æ‰€æœ‰æœºå™¨å®‰è£…Docker</h4>
<pre><code class="language-shell">cat &lt;&lt; END &gt; node_install_docker.sh

# --------æ£€æŸ¥æœ¬æœºæ˜¯å¦æœ‰æ—§ç‰ˆæœ¬Docker è¿›è¡Œå¸è½½-----------
sudo yum remove docker \
                  docker-client \
                  docker-client-latest \
                  docker-common \
                  docker-latest \
                  docker-latest-logrotate \
                  docker-logrotate \
                  docker-engine

# å®‰è£…utils,å› ä¸ºyum-config-managerç³»ç»Ÿé»˜è®¤æ²¡æœ‰å¸¦è¿™ä¸ªå‘½ä»¤,æ‰€ä»¥éœ€è¦
yum -y install yum-utils

# æ–°å¢ docker æºæ–‡ä»¶
yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo

# å®‰è£…æœ€æºæ–‡ä»¶æŒ‡å®šçš„æ–°ç‰ˆçš„docker,ä¹Ÿå¯ä»¥è‡ªå·±æŒ‡å®šç‰ˆæœ¬,é€šè¿‡yum list docker-ce --showduplicates | sort -r æŸ¥çœ‹å½“å‰ç‰ˆæœ¬
yum -y install docker-ce-18.06.0.ce-3.el7 docker-ce-cli-18.06.0.ce-3.el7 containerd.io

# å¯åŠ¨docker 
systemctl start docker

# é…ç½®Docker é˜¿é‡Œé•œåƒæºåŠ é€Ÿ
# Dockeré»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨çš„Cgroup Driverä¸ºcgroupfs,è€ŒKubernetesæ¨èä½¿ç”¨systemd,éœ€è¦åœ¨daemon.jsonä¸­é…ç½®
sudo mkdir -p /etc/docker
sudo tee /etc/docker/daemon.json &lt;&lt;-'EOF'
{
  &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;],
  &quot;registry-mirrors&quot;: [&quot;https://19towm9m.mirror.aliyuncs.com&quot;]
}
EOF
sudo systemctl daemon-reload
sudo systemctl restart docker
sudo systemctl enable docker

# è¿è¡Œhello world é•œåƒæŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸå¹¶ä¸”å¯ä»¥æ­£å¸¸è¿è¡Œ
docker run hello-world

END
</code></pre>
<p>æ‰§è¡Œè„šæœ¬</p>
<pre><code>. node_install_docker.sh
</code></pre>
<h4 id="6-æ—¶é—´åŒæ­¥">6) æ—¶é—´åŒæ­¥</h4>
<blockquote>
<p>Kubenetesè¦æ±‚é›†ç¾¤ä¸­çš„èŠ‚ç‚¹æ—¶é—´å¿…é¡»ç²¾ç¡®ä¸€ç›´,è¿™é‡Œç›´æ¥ä½¿ç”¨chronydæœåŠ¡ä»ç½‘ç»œåŒæ­¥æ—¶é—´</p>
<p>ä¼ä¸šç”Ÿäº§ç¯å¢ƒä¸­å»ºè®®é…ç½®å†…éƒ¨çš„æ—¶é—´åŒæ­¥æœåŠ¡å™¨</p>
</blockquote>
<pre><code class="language-shell">cat &lt;&lt; EOF &gt; ./start_chronyd.sh
systemctl start chronyd
systemctl enable chronyd
date
EOF

# æ‰§è¡Œ
. start_chronyd.sh
</code></pre>
<h4 id="7-å…³é—­ç³»ç»Ÿé˜²ç«å¢™ç­‰æ— ç”¨æœåŠ¡">7) å…³é—­ç³»ç»Ÿé˜²ç«å¢™ç­‰æ— ç”¨æœåŠ¡</h4>
<blockquote>
<p>Centos7 é»˜è®¤ä¼šæœ‰é˜²ç«å¢™ä»¥åŠSelinuxç­‰æœåŠ¡çš„å¼€å¯,è¿™é‡Œéœ€è¦å°†å…¶è¿›è¡Œå…³é—­</p>
</blockquote>
<pre><code class="language-shell">cat &lt;&lt; EOF &gt; stop_default_server.sh
# å…³é—­é˜²ç«å¢™åŠSELinuxç­‰æœåŠ¡
setenforce 0
sed -i 's/^SELINUX=enforcing$/SELINUX=disabled/' /etc/selinux/config

# å…³é—­swapåˆ†åŒº
swapoff -a &amp;&amp; sed -i '/ swap / s/^\(.*\)$/#\1/g' /etc/fstab

# å…³é—­é˜²ç«å¢™
systemctl stop firewalld
systemctl disable firewalld

# å…³é—­iptables(è‹¥ç³»ç»Ÿæœ¬èº«å¹¶æ²¡æœ‰å®‰è£…åˆ™ä¸éœ€è¦)
# systemctl stop iptables
# systemctl disable iptables

EOF

# æ‰§è¡Œè„šæœ¬
. stop_default_server.sh
</code></pre>
<p>é‡å¯æ‰€æœ‰ä¸»æœº,å¹¶é€ä¸ªæ£€æŸ¥é…ç½®</p>
<pre><code class="language-shell">cat &lt;&lt; EOF &gt; ./check.sh

echo -e &quot;\033[32m æ£€æŸ¥ç»“æœ: \033[0m&quot;

# æ£€æŸ¥firewalldæ˜¯å¦å…³é—­
systemctl status firewalld | grep &quot;active (running)&quot;
if [[ $? -eq 0 ]]; then
	echo -e &quot; firewalld å·²å…³é—­,æ ¡éªŒå®Œæˆ&quot;
fi

# æ£€æŸ¥selinux æ˜¯å¦å…³é—­
if [[ getenforce -eq &quot;Disabled&quot; ]]; then
	echo -e &quot; selinux å·²å…³é—­,æ ¡éªŒå®Œæˆ&quot;
fi

cat /etc/selinux/config |grep &quot;SELINUX=disabled&quot; &amp;&gt; /dev/null 
if [[ $? -eq 0 ]]; then
	echo -e &quot; selinux/config å·²æ°¸ä¹…ä¿®æ”¹,æ ¡éªŒå®Œæˆ&quot;
fi

# æ£€æŸ¥dockeræ˜¯å¦å¯åŠ¨
systemctl status docker | grep &quot;active (running)&quot; &amp;&gt; /dev/null 
if [[ $? -eq 0 ]]; then
	echo -e &quot; docker å·²æ­£å¸¸å¯åŠ¨,æ ¡éªŒå®Œæˆ&quot;
fi
EOF

# æ‰§è¡Œè„šæœ¬
. check.sh

 #æ£€æŸ¥ç»“æœ: 
 #firewalld å·²å…³é—­,æ ¡éªŒå®Œæˆ
 #selinux å·²å…³é—­,æ ¡éªŒå®Œæˆ
 #selinux/config å·²æ°¸ä¹…ä¿®æ”¹,æ ¡éªŒå®Œæˆ
 #docker å·²æ­£å¸¸å¯åŠ¨,æ ¡éªŒå®Œæˆ
</code></pre>
<h4 id="8å®‰è£…kubekeyä¾èµ–">8)å®‰è£…Kubekeyä¾èµ–</h4>
<blockquote>
<p>åªåœ¨ master èŠ‚ç‚¹å®‰è£…å³å¯</p>
</blockquote>
<pre><code class="language-shell">cat &lt;&lt; EOF &gt; install_kubekey.sh
yum install -y socat conntrack ebtables ipset
# ç¡®ä¿æ‚¨ä»æ­£ç¡®çš„åŒºåŸŸä¸‹è½½ KubeKeyï¼Œå³åœ¨å›½å†…ä¸‹è½½é€Ÿåº¦æ›´å¿«
export KKZONE=cn
# ä¸‹è½½kubekey
curl -sfL https://get-kk.kubesphere.io | sh 
EOF

. install_kubekey.sh

</code></pre>
<h4 id="9å¯åŠ¨kubenetesé›†ç¾¤">9)å¯åŠ¨Kubenetesé›†ç¾¤</h4>
<p>ä½¿ç”¨KubeKeyç”Ÿæˆä¸€ä¸ªk8sé›†ç¾¤å¯åŠ¨æ¨¡æ¿k8s.yamlï¼Œç¼–è¾‘å¥½è´¦å·å¯†ç åä¿å­˜</p>
<pre><code>./kk create config --with-kubernetes v1.22.1 -f k8s.init.yaml
</code></pre>
<p>æ¨¡æ¿å¦‚ä¸‹ï¼š</p>
<pre><code class="language-go">apiVersion: kubekey.kubesphere.io/v1alpha2
kind: Cluster
metadata:
  name: sample
spec:
  hosts:
  - {name: node1, address: node1çš„IPåœ°å€, internalAddress: node1çš„IPåœ°å€, user: è´¦å·, password: &quot;å¯†ç &quot;}
  - {name: node2, address: node2çš„IPåœ°å€, internalAddress: node2çš„IPåœ°å€, user: è´¦å·, password: &quot;å¯†ç &quot;}
  roleGroups:
    etcd: # æŒ‡å®šetcdå®‰è£…åˆ°å“ªä¸ªèŠ‚ç‚¹ä¸Š,ä¸€èˆ¬æˆ‘ä»¬å°†å…¶å®‰è£…åœ¨master æˆ–è€…å•ç‹¬çš„ä¸€ä¸ªä¸å·¥ä½œçš„èŠ‚ç‚¹ä¸Šåªç”¨äºå­˜å‚¨æ•°æ®
    - master
    control-plane:  # æŒ‡å®šæ§åˆ¶å™¨å®‰è£…åœ¨å“ªä¸ªèŠ‚ç‚¹ä¸Š
    - master 
    worker:  # æŒ‡å®šå·¥ä½œèŠ‚ç‚¹æœ‰å“ªäº›,å¯¹ç…§ä¸Šé¢hostsçš„nameå€¼
    - node1
    - node2
  controlPlaneEndpoint:
    ## Internal loadbalancer for apiservers
		# æ˜¯å¦å¼€å¯é«˜å¯ç”¨,å¦‚æœå¼€å¯å–æ¶ˆä¸‹é¢è¿™å¥çš„æ³¨é‡Š
    # internalLoadbalancer: haproxy

    domain: lb.kubesphere.local
    address: &quot;&quot;
    port: 6443
  kubernetes:
    version: v1.22.1
    clusterName: cluster.local
    autoRenewCerts: true
    containerManager: docker
  etcd:
    type: kubekey
  network:
    plugin: calico
    kubePodsCIDR: 10.233.64.0/18
    kubeServiceCIDR: 10.233.0.0/18
    ## multus support. https://github.com/k8snetworkplumbingwg/multus-cni
    multusCNI:
      enabled: false
  registry:
    privateRegistry: &quot;&quot;
    namespaceOverride: &quot;&quot;
    registryMirrors: []
    insecureRegistries: []
  addons: []
</code></pre>
<p>æ‰§è¡Œåˆšåˆšçš„æ–‡ä»¶</p>
<pre><code>./kk create cluster -f k8s.init.yaml
</code></pre>
<p>å®‰è£…å®Œæˆå¹¶è¿è¡ŒéªŒè¯</p>
<pre><code class="language-shell"># æŸ¥çœ‹æ‰€æœ‰Pod
kubectl get pods -A
</code></pre>
<p>è‡³æ­¤ï¼Œk8sé›†ç¾¤å·²ç»æ­å»ºå®Œæˆã€‚</p>
<h2 id="4-èµ„æºç®¡ç†">4. èµ„æºç®¡ç†</h2>
<p>å‘½ä»¤è¡Œ:</p>
<blockquote>
<p>é€šè¿‡å‘½ä»¤å½¢å¼æ“ä½œKubenetesèµ„æº,é‡‡ç”¨kubectl å‘½ä»¤</p>
</blockquote>
<table>
<thead>
<tr>
<th>å‘½ä»¤åˆ†ç±»</th>
<th>å‘½ä»¤</th>
<th style="text-align:center">ç¿»è¯‘</th>
<th style="text-align:left">å‘½ä»¤ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>åŸºæœ¬å‘½ä»¤</td>
<td>create</td>
<td style="text-align:center">åˆ›å»º</td>
<td style="text-align:left">åˆ›å»ºä¸€ä¸ªèµ„æº</td>
</tr>
<tr>
<td></td>
<td>edit</td>
<td style="text-align:center">ç¼–è¾‘</td>
<td style="text-align:left">ç¼–è¾‘ä¸€ä¸ªèµ„æº</td>
</tr>
<tr>
<td></td>
<td>get</td>
<td style="text-align:center">è·å–</td>
<td style="text-align:left">è·å–ä¸€ä¸ªèµ„æº</td>
</tr>
<tr>
<td></td>
<td>patch</td>
<td style="text-align:center">æ›´æ–°</td>
<td style="text-align:left">æ›´æ–°ä¸€ä¸ªèµ„æº</td>
</tr>
<tr>
<td></td>
<td>delete</td>
<td style="text-align:center">åˆ é™¤</td>
<td style="text-align:left">åˆ é™¤ä¸€ä¸ªèµ„æº</td>
</tr>
<tr>
<td></td>
<td>explain</td>
<td style="text-align:center">è§£é‡Š</td>
<td style="text-align:left">å±•ç¤ºèµ„æºæ–‡æ¡£</td>
</tr>
<tr>
<td>è¿è¡Œå’Œè°ƒè¯•</td>
<td>run</td>
<td style="text-align:center">è¿è¡Œ</td>
<td style="text-align:left">åœ¨é›†ç¾¤ä¸­è¿è¡Œä¸€ä¸ªæŒ‡å®šçš„é•œåƒ</td>
</tr>
<tr>
<td></td>
<td>expose</td>
<td style="text-align:center">æš´éœ²</td>
<td style="text-align:left">æš´éœ²èµ„æºä¸ºserviceæä¾›å¯¹å¤–æœåŠ¡</td>
</tr>
<tr>
<td></td>
<td>describe</td>
<td style="text-align:center">æè¿°</td>
<td style="text-align:left">æ˜¾ç¤ºèµ„æºå†…éƒ¨ä¿¡æ¯</td>
</tr>
<tr>
<td></td>
<td>logs</td>
<td style="text-align:center">æ—¥å¿—</td>
<td style="text-align:left">è¾“å‡ºå®¹å™¨åœ¨podä¸­çš„æ—¥å¿—</td>
</tr>
<tr>
<td></td>
<td>attach</td>
<td style="text-align:center">ç¼ ç»•</td>
<td style="text-align:left">è¿›å…¥è¿è¡Œä¸­çš„å®¹å™¨</td>
</tr>
<tr>
<td></td>
<td>exec</td>
<td style="text-align:center">æ‰§è¡Œ</td>
<td style="text-align:left">æ‰§è¡Œå®¹å™¨ä¸­çš„ä¸€ä¸ªå‘½ä»¤</td>
</tr>
<tr>
<td></td>
<td>cp</td>
<td style="text-align:center">å¤åˆ¶</td>
<td style="text-align:left">åœ¨podå†…å¤–çš„æ–‡ä»¶</td>
</tr>
<tr>
<td></td>
<td>rollout</td>
<td style="text-align:center">é¦–æ¬¡å±•ç¤º</td>
<td style="text-align:left">ç®¡ç†èµ„æºçš„å‘å¸ƒ</td>
</tr>
<tr>
<td></td>
<td>scale</td>
<td style="text-align:center">è§„æ¨¡</td>
<td style="text-align:left">æ‰©ç¼©å®¹podçš„æ•°é‡</td>
</tr>
<tr>
<td></td>
<td>autoscale</td>
<td style="text-align:center">è‡ªåŠ¨è°ƒæ•´</td>
<td style="text-align:left">è‡ªåŠ¨è°ƒæ•´podæ•°é‡</td>
</tr>
<tr>
<td>é«˜çº§å‘½ä»¤</td>
<td>apply</td>
<td style="text-align:center">rc</td>
<td style="text-align:left">é€šè¿‡æ–‡ä»¶å¯¹èµ„æºè¿›è¡Œé…ç½®</td>
</tr>
<tr>
<td></td>
<td>label</td>
<td style="text-align:center">æ ‡ç­¾</td>
<td style="text-align:left">æ›´æ–°èµ„æºä¸Šçš„æ ‡ç­¾</td>
</tr>
<tr>
<td>å…¶ä»–å‘½ä»¤</td>
<td>cluster-info</td>
<td style="text-align:center">é›†ç¾¤ä¿¡æ¯</td>
<td style="text-align:left">æ˜¾ç¤ºé›†ç¾¤ä¿¡æ¯</td>
</tr>
<tr>
<td></td>
<td>version</td>
<td style="text-align:center">ç‰ˆæœ¬</td>
<td style="text-align:left">æ˜¾ç¤ºå½“å‰serverçš„Clientç‰ˆæœ¬</td>
</tr>
</tbody>
</table>
<h3 id="1-èµ„æºç±»å‹">1) èµ„æºç±»å‹</h3>
<blockquote>
<p>Kubenetesä¸­æ‰€æœ‰çš„å†…å®¹éƒ½æŠ½è±¡ä¸ºèµ„æº,å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤è¿›è¡ŒæŸ¥çœ‹:</p>
</blockquote>
<pre><code class="language-shell">kubectl api-resources
</code></pre>
<p>ç»å¸¸ä½¿ç”¨çš„èµ„æºæœ‰ä¸‹é¢è¿™äº›:</p>
<table>
<thead>
<tr>
<th>èµ„æºåˆ†ç±»</th>
<th>èµ„æºåç§°</th>
<th>ç¼©å†™</th>
<th>èµ„æºä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>é›†ç¾¤çº§åˆ«èµ„æº</td>
<td>nodes</td>
<td>no</td>
<td>é›†ç¾¤ç»„æˆéƒ¨åˆ†å¦‚:kubectl get nodes</td>
</tr>
<tr>
<td></td>
<td>node</td>
<td></td>
<td>å•åªæŸä¸ªèŠ‚ç‚¹å¦‚:kubectl get node nodeåç§°</td>
</tr>
<tr>
<td></td>
<td>namespace</td>
<td>ns</td>
<td>éš”ç¦»pod</td>
</tr>
<tr>
<td>podèµ„æº</td>
<td>pods</td>
<td>po</td>
<td>podèµ„æºå¤æ•°å¦‚:kubectl get pods</td>
</tr>
<tr>
<td></td>
<td>pod</td>
<td></td>
<td>podèµ„æºå•ä¸ªå¦‚:kubectl get pod podåç§°</td>
</tr>
<tr>
<td></td>
<td>replicationcontrollers</td>
<td>rc</td>
<td>æ§åˆ¶podèµ„æº</td>
</tr>
<tr>
<td></td>
<td>replicasets</td>
<td>rs</td>
<td>æ§åˆ¶podèµ„æº</td>
</tr>
<tr>
<td></td>
<td>deployments</td>
<td>deploy</td>
<td>æ§åˆ¶podèµ„æº</td>
</tr>
<tr>
<td></td>
<td>daemonsets</td>
<td>ds</td>
<td>æ§åˆ¶podèµ„æº</td>
</tr>
<tr>
<td></td>
<td>jobs</td>
<td></td>
<td>æ§åˆ¶podèµ„æº</td>
</tr>
<tr>
<td></td>
<td>cronjobs</td>
<td>cj</td>
<td>æ§åˆ¶podèµ„æº</td>
</tr>
<tr>
<td></td>
<td>horizontalpodautoscalers</td>
<td>hpa</td>
<td>æ§åˆ¶podèµ„æº</td>
</tr>
<tr>
<td>æœåŠ¡å‘ç°èµ„æº</td>
<td>service</td>
<td>svc</td>
<td>ç»Ÿä¸€podå¯¹å¤–æ¥å£</td>
</tr>
<tr>
<td></td>
<td>ingress</td>
<td>ing</td>
<td>ç»Ÿä¸€podå¯¹å¤–æ¥å£</td>
</tr>
<tr>
<td>å­˜å‚¨èµ„æº</td>
<td>volumeattachments</td>
<td></td>
<td>å­˜å‚¨</td>
</tr>
<tr>
<td></td>
<td>persistentvolumes</td>
<td>pv</td>
<td>å­˜å‚¨</td>
</tr>
<tr>
<td></td>
<td>persistentvolumeclaims</td>
<td>pvc</td>
<td>å­˜å‚¨</td>
</tr>
<tr>
<td>é…ç½®èµ„æº</td>
<td>configmaps</td>
<td>cm</td>
<td>é…ç½®</td>
</tr>
<tr>
<td></td>
<td>secrets</td>
<td></td>
<td>é…ç½®</td>
</tr>
</tbody>
</table>
<h3 id="2èµ„æºç®¡ç†æ–¹å¼">2)èµ„æºç®¡ç†æ–¹å¼</h3>
<ol>
<li>
<p>å‘½ä»¤å¯¹è±¡ç®¡ç†:</p>
<pre><code class="language-shell">kubectl run nginx-pod --image=nginx:latest --port=80
</code></pre>
</li>
<li>
<p>å‘½ä»¤å¯¹è±¡é…ç½®æ–‡ä»¶:</p>
<pre><code class="language-shell">kubectl create/patch/delete -f nginx-pod.yml
# æ‰€æœ‰é…ç½®ä¿¡æ¯å…¨éƒ¨å†™åœ¨nginx-pod.yml,é€šè¿‡-fæŒ‡å®šæ–‡ä»¶
</code></pre>
</li>
<li>
<p>å£°æ˜å¯¹è±¡é…ç½®: é€šè¿‡applyå‘½ä»¤æŒ‰ç…§æŒ‡å®šé…ç½®æ–‡ä»¶åˆ›å»ºå’Œæ›´æ–°Podèµ„æº(åªèƒ½åˆ›å»ºå’Œæ›´æ–°)</p>
<pre><code class="language-shell">kubectl apply -f nginx-pod.yml
</code></pre>
</li>
</ol>
<h3 id="3å‘½ä»¤å¯¹è±¡é…ç½®åˆ›å»ºnamespacepod">3)å‘½ä»¤å¯¹è±¡é…ç½®åˆ›å»ºNamespace/Pod</h3>
<pre><code class="language-yml">apiVersion: v1
kind: Namespace
metadata: 
	name: dev
--- # åˆ›å»ºNamespace
apiVersion: v1
kind: Pod
metadata: 
	# podåç§°
	name: nginx-pod 
	# podæ‰€åœ¨namespace
	namespace: dev 
	
spec:
	containers: 
		#å®¹å™¨åç§°
    - name: nginx-container1	
      image: nginx:latest
      port: 80
    - name: nginx-container2
      image: nginx:latest
			port: 81
--- # åˆ›å»ºpodå¹¶æ·»åŠ å®¹å™¨
</code></pre>
<pre><code class="language-shell"># æ ¹æ®nginx-pod æ‰§è¡Œåˆ›å»º
kc create -f nginx-pod.yml

# æ ¹æ®nginx-pod æ–‡ä»¶åˆ é™¤å¯¹åº”èµ„æº
kc delete -f nginx-pod.yml
</code></pre>
<h3 id="4å£°æ˜å¯¹è±¡é…ç½®åˆ›å»ºå’Œæ›´æ–°namespacepod">4)å£°æ˜å¯¹è±¡é…ç½®åˆ›å»ºå’Œæ›´æ–°Namespace/Pod</h3>
<pre><code class="language-shell">kc apply -f nginx-pod.yml
# å¦‚æœå·²æœ‰é…ç½®æ–‡ä»¶çš„Podå†…å®¹,åˆ™æ£€æŸ¥æ–‡ä»¶æ˜¯å¦æ›´æ–°,è‹¥æ›´æ–°æŒ‰ç…§é…ç½®æ–‡ä»¶ä¿®æ”¹podèµ„æº,è‹¥æ— ä»€ä¹ˆéƒ½ä¸åš
</code></pre>
<h3 id="5-kubectlåœ¨nodeèŠ‚ç‚¹æ‰§è¡Œ">5) kubectlåœ¨nodeèŠ‚ç‚¹æ‰§è¡Œ</h3>
<pre><code class="language-shell"># é»˜è®¤æƒ…å†µä¸‹kubectl åœ¨nodeèŠ‚ç‚¹ä¸Šæ— æ³•æ­£å¸¸æ‰§è¡Œ,è¿™æ˜¯å› ä¸ºkubectlæ‰§è¡Œéœ€è¦.kubeç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶,å¯ä»¥é€šè¿‡å°†masterèŠ‚ç‚¹ä¸Š~/.kube å¤åˆ¶ä¸€ä»½å‘é€åˆ°nodeä¸Šçš„~/å³å¯

# å¥½æ¶ˆæ¯æ˜¯,é‡‡ç”¨ä¸Šè¿°kubekeyæ­å»ºçš„Kubenetesé»˜è®¤å°±ä¼šåšåŒæ­¥æ“ä½œ,è¿™é‡Œåªæ˜¯è®°å½•ä¸‹ä¸éœ€è¦è¿›è¡Œæ“ä½œ
</code></pre>
<h3 id="æ³¨æ„">*)æ³¨æ„</h3>
<blockquote>
<p>run ä¸€ä¸ªpod èµ„æºæ—¶éœ€è¦æŒ‡å®šname,ä¸éœ€è¦æ·»åŠ podå…³é”®å­—,å¯ä»¥é€šè¿‡ä¸‹é¢å‘½ä»¤å‘ç°,æˆ‘ä»¬æ²¡æœ‰ç›´æ¥æŒ‡å®špod èµ„æºè€Œæ˜¯ç»™äº†åå­—,è¿™é‡Œç‰¹æ®Šéœ€è¦è®°ä¸€ä¸‹</p>
<p>å¦‚: kubectl run name --image=nginx:latest -n æŒ‡å®šnamespace</p>
</blockquote>
<blockquote>
<p>kubectl -&gt; kc å› ä¸ºåœ¨é…ç½®æ–‡ä»¶ä¸­åšäº†alias</p>
</blockquote>
<h2 id="5-å…¥é—¨è®²è§£">5. å…¥é—¨è®²è§£</h2>
<h3 id="1-namespaceå…¥é—¨è®²è§£">1. Namespaceå…¥é—¨è®²è§£</h3>
<pre><code class="language-shell">[root@master ~]# kc get ns
NAME              STATUS   AGE 
default           Active   18h	# æ‰€æœ‰æœªæŒ‡å®šnsçš„podéƒ½æ”¾åˆ°defaultä¸‹
kube-node-lease   Active   18h	# é›†ç¾¤èŠ‚ç‚¹ä¹‹é—´çš„å¿ƒè·³ç»´æŠ¤,v1.13å¼€å§‹å¼•å…¥
kube-public       Active   18h	# æ­¤å‘½åç©ºé—´ä¸‹çš„èµ„æºå¯ä»¥è¢«æ‰€æœ‰äººæ–¹ä½(åŒ…æ‹¬æœªè®¤è¯)
kube-system       Active   18h	# æ‰€æœ‰ç”±Kubernetesç³»ç»Ÿåˆ›å»ºçš„èµ„æºéƒ½å¤„äºè¿™ä¸ªå‘½åç©ºé—´ä¸­
kubekey-system    Active   18h
</code></pre>
<p>åˆ›å»ºns</p>
<pre><code class="language-shell">kubectl create ns åç§°
</code></pre>
<p>åˆ é™¤ns</p>
<pre><code>kubectl delete ns åç§°
</code></pre>
<p>ymlæ–‡ä»¶åˆ›å»ºå’Œåˆ é™¤ns</p>
<pre><code class="language-yml">apiVersion: apps/v1
kind: Namespace
metadata: 
  name: dev
</code></pre>
<pre><code class="language-shell">[root@master ~]# kc create -f create-ns.yml  # é€šè¿‡æ–‡ä»¶åˆ›å»º
namespace/dev created
[root@master ~]# kc delete -f create-ns.yml # é€šè¿‡æ–‡ä»¶åˆ é™¤
namespace &quot;dev&quot; deleted
</code></pre>
<h3 id="2podå…¥é—¨è®²è§£">2.Podå…¥é—¨è®²è§£</h3>
<p>Podæ˜¯Kubenetesé›†ç¾¤è¿›è¡Œç®¡ç†çš„æœ€å°å•å…ƒ,ç¨‹åºè¦è¿è¡Œå¿…é¡»åœ¨å®¹å™¨ä¸­,å®¹å™¨å¿…é¡»å­˜äºPod.</p>
<p>ä¸€ä¸ªPodä¸­å­˜åœ¨ä¸€ä¸ªæ ¹å®¹å™¨Pause å’Œå¤šä¸ªç”¨æˆ·æŒ‡å®šçš„å®¹å™¨</p>
<p>åˆ›å»ºPod</p>
<pre><code class="language-shell">kubectl run nginx-pod --image=nginx:latest --port=80
# é™¤ä»¥ä¸Šæ–¹å¼è¿˜æœ‰å¦å¤–ä¸¤ç§åˆ›å»ºæ–¹å¼,éœ€è¦è¯·è§‚å¯Ÿèµ„æºç®¡ç†ä¸­çš„3å’Œ4
</code></pre>
<p>æŸ¥è¯¢Pod</p>
<pre><code>kubectl get pods
# è·å–é»˜è®¤namespaceä¸‹çš„æ‰€æœ‰podä¿¡æ¯,å¦‚æœéœ€è¦æŒ‡å®šnamespaceå¯ä»¥ä½¿ç”¨ -n namespaceåç§°
</code></pre>
<p>æŸ¥çœ‹Podè¯¦æƒ…</p>
<pre><code>kubectl describe pod nginx-pod
# kubectl describe pod podåç§°
</code></pre>
<p>è®¿é—®PodæœåŠ¡</p>
<pre><code>curl podIp:ç«¯å£
# è®¿é—®æœåŠ¡èµ„æº
</code></pre>
<h3 id="3labelå…¥é—¨è®²è§£">3.Labelå…¥é—¨è®²è§£</h3>
<p>Labelç”¨äºç»™æŒ‡å®šèµ„æºæ‰“æ ‡ç­¾,åç»­å¯ä»¥é€šè¿‡æ ‡ç­¾ç­›é€‰,æ ‡ç­¾æ·»åŠ åœ¨Node,Pod,Serviceç­‰ç­‰</p>
<p>ç‰¹ç‚¹:</p>
<ol>
<li>ä¸€ä¸ªLabelä¼šä»¥key/valueé”®å€¼å¯¹çš„å½¢å¼é™„åŠ åˆ°å„ç§å¯¹è±¡ä¸Š</li>
<li>ä¸€ä¸ªèµ„æºå¯¹è±¡å¯ä»¥å®šä¹‰ä»»æ„æ•°é‡çš„Label,åŒä¸€ä¸ªLabelä¹Ÿå¯ä»¥è¢«æ·»åŠ åˆ°ä»»æ„æ•°é‡çš„èµ„æºå¯¹è±¡ä¸Šå»</li>
<li>Labelé€šå¸¸åœ¨èµ„æºå¯¹è±¡å®šä¹‰æ—¶ç¡®å®š,å½“ç„¶ä¹Ÿå¯ä»¥åœ¨å¯¹è±¡åˆ›å»ºååŠ¨æ€æ·»åŠ æˆ–è€…åˆ é™¤</li>
</ol>
<p>ä¸ºPodæ·»åŠ Label</p>
<pre><code>kubectl label pod podåç§° key=value,key2=value,...
</code></pre>
<p>ä¸ºPodæ›´æ–°Lable</p>
<pre><code>kubectl lable pod podåç§° key=value --overwriter
</code></pre>
<p>æŸ¥çœ‹Podæ ‡ç­¾</p>
<pre><code>kubectl get pod podåç§° --show-labels
</code></pre>
<p>ç­›é€‰æ ‡ç­¾</p>
<pre><code>kubectl get pods -l key=value,key!=value
# å¤šä¸ªæ¡ä»¶æ˜¯å¹¶é›†,ä¸”ç”¨é€—å·åˆ†éš”
</code></pre>
<p>åˆ é™¤æ ‡ç­¾</p>
<pre><code>kubectl label pod podåç§° key- 
</code></pre>
<h3 id="4deploymentå…¥é—¨è®²è§£">4.Deploymentå…¥é—¨è®²è§£</h3>
<p>åœ¨Kubenetesä¸­,Podæ˜¯æœ€å°çš„æ§åˆ¶å•å…ƒ,ä½†æ˜¯Kuberneteså¾ˆå°‘ç›´æ¥æ§åˆ¶Pod,ä¸€èˆ¬éƒ½æ˜¯é€šè¿‡Podæ§åˆ¶å™¨æ¥å®Œæˆçš„,Podæ§åˆ¶å™¨ç”¨äºPodçš„ç®¡ç†,ç¡®ä¿podèµ„æºç¬¦åˆé¢„æœŸçš„çŠ¶æ€,å½“Podçš„èµ„æºå‡ºç°æ•…éšœæ—¶,ä¼šå°è¯•è¿›è¡Œé‡å¯æˆ–è€…é‡å»ºPod</p>
<p>Podæ§åˆ¶å™¨æœ‰å¾ˆå¤šç§,è¿™é‡ŒåªèŠDeployment</p>
<p>åˆ›å»ºdeploymentå‰¯æœ¬pod</p>
<pre><code>kc create deployment nginx-pod --image=nginx:latest --port=80 --replicas=3 
</code></pre>
<p>åˆ é™¤deploymentå‰¯æœ¬pod</p>
<pre><code>kc delete deployment nginx-pod
</code></pre>
<p>é€šè¿‡ymlæ–‡ä»¶åˆ›å»º,ä¿®æ”¹å’Œåˆ é™¤</p>
<pre><code class="language-yml">apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx  # deploymentåç§°
spec:
  replicas: 2  # å‰¯æœ¬æ•°é‡
  selector:
    matchLabels:  # é€‰æ‹©æ ‡ç­¾
       run: nginx  # templateæ¨¡æ¿åŒºåŸŸä¸­å¯¹åº”æ ‡ç­¾çš„æ¨¡ç‰ˆ
  template:
    metadata:
      labels:
        run: nginx  # å®šä¹‰æ ‡ç­¾ä¸matchLabelså‘¼åº”,è¡¨ç¤ºå½“å‰æ¨¡ç‰ˆéœ€è¦ä½¿ç”¨åˆ°replicas
    spec:
      containers:
      - image: nginx:latest  # podä¸­ç®¡ç†å®¹å™¨éœ€è¦ä½¿ç”¨çš„é•œåƒ
        name: nginx-container1 # å®¹å™¨åç§°
        ports:
        - containerPort: 80	# å®¹å™¨æš´æ¼ç«¯å£
          protocol: TCP		# ç½‘ç»œè¿æ¥åè®®
</code></pre>
<p>ç¼–å†™æ–‡ä»¶åå¯æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p>
<pre><code class="language-shell"># åˆ›å»º
kubectl create -f deployment.yml 
# åˆ é™¤
kubectl delete -f deployment.yml
# åˆ›å»ºä¸æ›´æ–°
kubectl apply -f deployment.yml
# æŸ¥çœ‹podså¯ä»¥æ·»åŠ -l æ ¹æ®æ ‡ç­¾è¿‡æ»¤
kubectl get pods -l run=nginx
# æŸ¥çœ‹deployment,å¯ä»¥æŒ‡å®šåç§°,ä¹Ÿå¯ä»¥ä¸æŒ‡å®šåç§°
kubectl get deployment   
</code></pre>
<h3 id="4serviceå…¥é—¨è®²è§£">4.Serviceå…¥é—¨è®²è§£</h3>
<p>åœ¨åŸæœ‰podä¸­,æ¯æ¬¡æ–°å»ºPodIpåœ°å€éƒ½ä¼šéšç€æ”¹å˜,è¿™å°±é€ æˆäº†æ— æ³•ç›´æ¥é€šè¿‡ipåœ°å€è®¿é—®Pod,å¯èƒ½ä¸‹ä¸€ç§’å‡ºç°é—®é¢˜,é‡å»ºä¸ªpodIpå°±å˜äº†,é‚£ä¹ˆServiceå°±æ˜¯ç”¨æ¥è§£å†³ä»£ç†Podè®¿é—®ä»¥åŠè´Ÿè½½å‡è¡¡çš„ä½œç”¨,</p>
<p>serviceå›¾1:<br>
<img src="http://ggcodec.github.io/post-images/1677345745713.png" alt="" loading="lazy"></p>
<p>å½“å®¢æˆ·ç«¯è®¿é—®Serviceä½¿,service é€šè¿‡selectoré€‰æ‹©æ ‡ç­¾çš„å½¢å¼æ‰¾åˆ°å¯¹åº”çš„podæœåŠ¡,å¹¶è·å–ipè¿›è¡Œè´Ÿè½½å‡è¡¡è¯·æ±‚,è€ŒServiceæœ¬èº«æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­Ipéƒ½ä¸ä¼šæ”¹å˜.</p>
<p>åˆ›å»ºserviceæš´éœ²æœåŠ¡ç«¯å£</p>
<pre><code class="language-shell">[root@master ~]# kc expose deployment nginx --name=svc-nginx1 --type=ClusterIP --port=80 --target-port=80

# expose deployment podæ§åˆ¶å™¨åç§°
# --name=svc-nginx1 æŒ‡å®šserviceåç§°
# --type=ClusterIP  ç±»å‹æŒ‡å®šä¸ºé›†ç¾¤IP,ä»…å½“å‰ä¸»æœºèƒ½å¤Ÿè®¿é—®
# --type=NodePort  ç±»å‹æŒ‡å®šä¸ºä¸»æœºç«¯å£æ˜ å°„,å¤–éƒ¨ç”¨æˆ·å¯ä»¥è®¿é—®æŒ‡å®šæ¥å£,è¯·æ±‚æœåŠ¡
# --port=80			serviceæš´éœ²çš„ç«¯å£å·
# --tartget-port=80  ç›®æ ‡æœåŠ¡ç«¯æš´æ¼çš„ç«¯å£å·

# æ›´æ¢ç±»å‹
[root@master ~]# kc expose deployment nginx --name=svc-nginx1 --type=NodePort --port=80 --target-port=80
[root@master ~]# kc get svc
NAME         TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)        AGE
kubernetes   ClusterIP   10.233.0.1     &lt;none&gt;        443/TCP        25h
svc-nginx1   NodePort    10.233.51.62   &lt;none&gt;        80:31008/TCP   2m45s

# è¿™é‡Œå¯ä»¥å‘ç°æˆ‘ä»¬åˆ›å»ºsvc-nginx1 ç±»å‹é€‰æ‹©NodePortå,ç«¯å£å¤„æœ‰ä¸¤ä¸ªç«¯å£å·,80ç«¯å£æ˜¯å†…éƒ¨æš´éœ²ç«¯å£ä»…ç”¨äºå†…éƒ¨è®¿é—®,è€Œå¤–éƒ¨éœ€è¦æ–¹ä½31008ç«¯å£æ‰èƒ½è¯·æ±‚åˆ°æœåŠ¡
[root@master ~]# curl http://192.168.140.132:31008/
</code></pre>
<p>åˆ é™¤service</p>
<pre><code class="language-shell">kubectl delete svc svc-nginx1
</code></pre>
<p>ymlæ–‡ä»¶åˆ›å»ºService</p>
<pre><code class="language-yml"> 
</code></pre>
<h2 id="6podè¯¦è§£">6.Podè¯¦è§£</h2>
<p>Podç»“æ„å›¾:</p>
<figure data-type="image" tabindex="1"><img src="http://ggcodec.github.io/post-images/1677345766670.png" alt="" loading="lazy"></figure>
<p>æ¯ä¸ªPodä¸­éƒ½å¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–è€…å¤šä¸ªå®¹å™¨,è¿™äº›å®¹å™¨å¯ä»¥åˆ†ä¸ºä¸¤ç±»:</p>
<ul>
<li>
<p>ç”¨æˆ·ç¨‹åºæ‰€åœ¨çš„å®¹å™¨,æ•°é‡å¯å¤šå¯å°‘</p>
</li>
<li>
<p>Pauseå®¹å™¨,è¿™æ˜¯æ¯ä¸ªPodéƒ½ä¼šæœ‰çš„ä¸€ä¸ªæ ¹å®¹å™¨,ä»–çš„ä½œç”¨æœ‰ä¸¤ä¸ª</p>
<ol>
<li>
<p>å¯ä»¥ä»¥ä»–ä¸ºä¾æ®,è¯„ä¼°æ•´ä¸ªPodçš„å¥åº·çŠ¶æ€</p>
</li>
<li>
<p>å¯ä»¥åœ¨æ ¹å®¹å™¨ä¸Šè®¾ç½®Ipåœ°å€,å…¶ä»–å®¹å™¨éƒ½ä»¥æ­¤Ip,å®ç°Podå†…éƒ¨çš„ç½‘è·¯é€šä¿¡</p>
<blockquote>
<p>è¿™é‡ŒPodå†…éƒ¨çš„é€šè®¯,Podä¹‹é—´çš„é€šè®¯é‡‡ç”¨è™šæ‹ŸäºŒå±‚ç½‘è·¯æŠ€æœ¯å®ç°æˆ‘ä»¬å½“å‰ç¯å¢ƒæ˜¯Flannel</p>
</blockquote>
</li>
</ol>
</li>
</ul>
<h3 id="1-podèµ„æºæ¸…å•">1) Podèµ„æºæ¸…å•</h3>
<pre><code class="language-yml">apiVersion: v1     #å¿…é€‰ï¼Œç‰ˆæœ¬å·ï¼Œä¾‹å¦‚v1
kind: Pod       ã€€ #å¿…é€‰ï¼Œèµ„æºç±»å‹ï¼Œä¾‹å¦‚ Pod
metadata:       ã€€ #å¿…é€‰ï¼Œå…ƒæ•°æ®
  name: string     #å¿…é€‰ï¼ŒPodåç§°
  namespace: string  #Podæ‰€å±çš„å‘½åç©ºé—´,é»˜è®¤ä¸º&quot;default&quot;
  labels:       ã€€ã€€  #è‡ªå®šä¹‰æ ‡ç­¾åˆ—è¡¨
    - name: string      ã€€          
spec:  #å¿…é€‰ï¼ŒPodä¸­å®¹å™¨çš„è¯¦ç»†å®šä¹‰
  containers:  #å¿…é€‰ï¼ŒPodä¸­å®¹å™¨åˆ—è¡¨
  - name: string   #å¿…é€‰ï¼Œå®¹å™¨åç§°
    image: string  #å¿…é€‰ï¼Œå®¹å™¨çš„é•œåƒåç§°
    imagePullPolicy: [ Always|Never|IfNotPresent ]  #è·å–é•œåƒçš„ç­–ç•¥ 
    command: [string]   #å®¹å™¨çš„å¯åŠ¨å‘½ä»¤åˆ—è¡¨ï¼Œå¦‚ä¸æŒ‡å®šï¼Œä½¿ç”¨æ‰“åŒ…æ—¶ä½¿ç”¨çš„å¯åŠ¨å‘½ä»¤
    args: [string]      #å®¹å™¨çš„å¯åŠ¨å‘½ä»¤å‚æ•°åˆ—è¡¨
    workingDir: string  #å®¹å™¨çš„å·¥ä½œç›®å½•
    volumeMounts:       #æŒ‚è½½åˆ°å®¹å™¨å†…éƒ¨çš„å­˜å‚¨å·é…ç½®
    - name: string      #å¼•ç”¨podå®šä¹‰çš„å…±äº«å­˜å‚¨å·çš„åç§°ï¼Œéœ€ç”¨volumes[]éƒ¨åˆ†å®šä¹‰çš„çš„å·å
      mountPath: string #å­˜å‚¨å·åœ¨å®¹å™¨å†…mountçš„ç»å¯¹è·¯å¾„ï¼Œåº”å°‘äº512å­—ç¬¦
      readOnly: boolean #æ˜¯å¦ä¸ºåªè¯»æ¨¡å¼
    ports: #éœ€è¦æš´éœ²çš„ç«¯å£åº“å·åˆ—è¡¨
    - name: string        #ç«¯å£çš„åç§°
      containerPort: int  #å®¹å™¨éœ€è¦ç›‘å¬çš„ç«¯å£å·
      hostPort: int       #å®¹å™¨æ‰€åœ¨ä¸»æœºéœ€è¦ç›‘å¬çš„ç«¯å£å·ï¼Œé»˜è®¤ä¸Containerç›¸åŒ
      protocol: string    #ç«¯å£åè®®ï¼Œæ”¯æŒTCPå’ŒUDPï¼Œé»˜è®¤TCP
    env:   #å®¹å™¨è¿è¡Œå‰éœ€è®¾ç½®çš„ç¯å¢ƒå˜é‡åˆ—è¡¨
    - name: string  #ç¯å¢ƒå˜é‡åç§°
      value: string #ç¯å¢ƒå˜é‡çš„å€¼
    resources: #èµ„æºé™åˆ¶å’Œè¯·æ±‚çš„è®¾ç½®
      limits:  #èµ„æºé™åˆ¶çš„è®¾ç½®
        cpu: string     #Cpuçš„é™åˆ¶ï¼Œå•ä½ä¸ºcoreæ•°ï¼Œå°†ç”¨äºdocker run --cpu-shareså‚æ•°
        memory: string  #å†…å­˜é™åˆ¶ï¼Œå•ä½å¯ä»¥ä¸ºMib/Gibï¼Œå°†ç”¨äºdocker run --memoryå‚æ•°
      requests: #èµ„æºè¯·æ±‚çš„è®¾ç½®
        cpu: string    #Cpuè¯·æ±‚ï¼Œå®¹å™¨å¯åŠ¨çš„åˆå§‹å¯ç”¨æ•°é‡
        memory: string #å†…å­˜è¯·æ±‚,å®¹å™¨å¯åŠ¨çš„åˆå§‹å¯ç”¨æ•°é‡
    lifecycle: #ç”Ÿå‘½å‘¨æœŸé’©å­
        postStart: #å®¹å™¨å¯åŠ¨åç«‹å³æ‰§è¡Œæ­¤é’©å­,å¦‚æœæ‰§è¡Œå¤±è´¥,ä¼šæ ¹æ®é‡å¯ç­–ç•¥è¿›è¡Œé‡å¯
        preStop: #å®¹å™¨ç»ˆæ­¢å‰æ‰§è¡Œæ­¤é’©å­,æ— è®ºç»“æœå¦‚ä½•,å®¹å™¨éƒ½ä¼šç»ˆæ­¢
    livenessProbe:  #å¯¹Podå†…å„å®¹å™¨å¥åº·æ£€æŸ¥çš„è®¾ç½®ï¼Œå½“æ¢æµ‹æ— å“åº”å‡ æ¬¡åå°†è‡ªåŠ¨é‡å¯è¯¥å®¹å™¨
      exec:       ã€€ #å¯¹Podå®¹å™¨å†…æ£€æŸ¥æ–¹å¼è®¾ç½®ä¸ºexecæ–¹å¼
        command: [string]  #execæ–¹å¼éœ€è¦åˆ¶å®šçš„å‘½ä»¤æˆ–è„šæœ¬
      httpGet:       #å¯¹Podå†…ä¸ªå®¹å™¨å¥åº·æ£€æŸ¥æ–¹æ³•è®¾ç½®ä¸ºHttpGetï¼Œéœ€è¦åˆ¶å®šPathã€port
        path: string
        port: number
        host: string
        scheme: string
        HttpHeaders:
        - name: string
          value: string
      tcpSocket:     #å¯¹Podå†…ä¸ªå®¹å™¨å¥åº·æ£€æŸ¥æ–¹å¼è®¾ç½®ä¸ºtcpSocketæ–¹å¼
         port: number
       initialDelaySeconds: 0       #å®¹å™¨å¯åŠ¨å®Œæˆåé¦–æ¬¡æ¢æµ‹çš„æ—¶é—´ï¼Œå•ä½ä¸ºç§’
       timeoutSeconds: 0    ã€€ã€€    #å¯¹å®¹å™¨å¥åº·æ£€æŸ¥æ¢æµ‹ç­‰å¾…å“åº”çš„è¶…æ—¶æ—¶é—´ï¼Œå•ä½ç§’ï¼Œé»˜è®¤1ç§’
       periodSeconds: 0     ã€€ã€€    #å¯¹å®¹å™¨ç›‘æ§æ£€æŸ¥çš„å®šæœŸæ¢æµ‹æ—¶é—´è®¾ç½®ï¼Œå•ä½ç§’ï¼Œé»˜è®¤10ç§’ä¸€æ¬¡
       successThreshold: 0
       failureThreshold: 0
       securityContext:
         privileged: false
  restartPolicy: [Always | Never | OnFailure]  #Podçš„é‡å¯ç­–ç•¥
  nodeName: &lt;string&gt; #è®¾ç½®NodeNameè¡¨ç¤ºå°†è¯¥Podè°ƒåº¦åˆ°æŒ‡å®šåˆ°åç§°çš„nodeèŠ‚ç‚¹ä¸Š
  nodeSelector: obeject #è®¾ç½®NodeSelectorè¡¨ç¤ºå°†è¯¥Podè°ƒåº¦åˆ°åŒ…å«è¿™ä¸ªlabelçš„nodeä¸Š
  imagePullSecrets: #Pullé•œåƒæ—¶ä½¿ç”¨çš„secretåç§°ï¼Œä»¥keyï¼šsecretkeyæ ¼å¼æŒ‡å®š
  - name: string
  hostNetwork: false   #æ˜¯å¦ä½¿ç”¨ä¸»æœºç½‘ç»œæ¨¡å¼ï¼Œé»˜è®¤ä¸ºfalseï¼Œå¦‚æœè®¾ç½®ä¸ºtrueï¼Œè¡¨ç¤ºä½¿ç”¨å®¿ä¸»æœºç½‘ç»œ
  volumes:   #åœ¨è¯¥podä¸Šå®šä¹‰å…±äº«å­˜å‚¨å·åˆ—è¡¨
  - name: string    #å…±äº«å­˜å‚¨å·åç§° ï¼ˆvolumesç±»å‹æœ‰å¾ˆå¤šç§ï¼‰
    emptyDir: {}       #ç±»å‹ä¸ºemtyDirçš„å­˜å‚¨å·ï¼Œä¸PodåŒç”Ÿå‘½å‘¨æœŸçš„ä¸€ä¸ªä¸´æ—¶ç›®å½•ã€‚ä¸ºç©ºå€¼
    hostPath: string   #ç±»å‹ä¸ºhostPathçš„å­˜å‚¨å·ï¼Œè¡¨ç¤ºæŒ‚è½½Podæ‰€åœ¨å®¿ä¸»æœºçš„ç›®å½•
      path: string      ã€€ã€€        #Podæ‰€åœ¨å®¿ä¸»æœºçš„ç›®å½•ï¼Œå°†è¢«ç”¨äºåŒæœŸä¸­mountçš„ç›®å½•
    secret:       ã€€ã€€ã€€#ç±»å‹ä¸ºsecretçš„å­˜å‚¨å·ï¼ŒæŒ‚è½½é›†ç¾¤ä¸å®šä¹‰çš„secretå¯¹è±¡åˆ°å®¹å™¨å†…éƒ¨
      scretname: string  
      items:     
      - key: string
        path: string
    configMap:         #ç±»å‹ä¸ºconfigMapçš„å­˜å‚¨å·ï¼ŒæŒ‚è½½é¢„å®šä¹‰çš„configMapå¯¹è±¡åˆ°å®¹å™¨å†…éƒ¨
      name: string
      items:
      - key: string
        path: string
</code></pre>
<p>è·å–Podèµ„æºæ¸…å•</p>
<pre><code class="language-shell"># æŸ¥çœ‹specä¸‹çš„containersä¸‹çš„èµ„æºæ¸…å•
kubectl explain pod.spec.containers
# æŸ¥è¯¢podä¸€çº§å±æ€§
kubectl explain pod
# æŸ¥è¯¢ deployment ä¸€çº§å±æ€§
kubectl explain deployment
</code></pre>
<blockquote>
<p>åœ¨ kubernetes ä¸­åŸºæœ¬æ‰€æœ‰èµ„æºçš„ä¸€çº§å±æ€§éƒ½æ˜¯ä¸€æ ·çš„ï¼Œä¸»è¦åŒ…å«5éƒ¨åˆ†ï¼š</p>
<ul>
<li>apiVersion ç‰ˆæœ¬ï¼Œç”± kubernetes å†…éƒ¨å®šä¹‰ï¼Œç‰ˆæœ¬å·å¿…é¡»å¯ä»¥ç”¨ kubectl api-versions æŸ¥è¯¢åˆ°</li>
<li>kind ç±»å‹ï¼Œç”± kubernetes å†…éƒ¨å®šä¹‰ï¼Œç±»å‹å¯ä»¥ç”¨ kubectl api-resources æŸ¥è¯¢åˆ°</li>
<li>metadata å…ƒæ•°æ®ï¼Œä¸»è¦æ˜¯èµ„æºæ ‡è¯†å’Œè¯´æ˜ï¼Œå¸¸ç”¨çš„æœ‰ nameã€namespaceã€labels ç­‰</li>
<li>spec æè¿°ï¼Œè¿™æ˜¯é…ç½®ä¸­æœ€é‡è¦çš„ä¸€éƒ¨åˆ†ï¼Œé‡Œé¢æ˜¯å¯¹å„ç§èµ„æºé…ç½®çš„è¯¦ç»†æè¿°</li>
<li>status çŠ¶æ€ä¿¡æ¯ï¼Œé‡Œé¢çš„å†…å®¹ä¸éœ€è¦å®šä¹‰ï¼Œç”± kubernetes è‡ªåŠ¨ç”Ÿæˆ</li>
</ul>
<p>åœ¨ä¸Šé¢çš„å±æ€§ä¸­ï¼Œspec æ˜¯æ¥ä¸‹æ¥ç ”ç©¶çš„é‡ç‚¹ï¼Œç»§ç»­çœ‹ä¸‹å®ƒçš„å¸¸è§å­å±æ€§:</p>
<ul>
<li>containers &lt;[]Object&gt; å®¹å™¨åˆ—è¡¨ï¼Œç”¨äºå®šä¹‰å®¹å™¨çš„è¯¦ç»†ä¿¡æ¯</li>
<li>nodeName æ ¹æ® nodeName çš„å€¼å°† pod è°ƒåº¦åˆ°æŒ‡å®šçš„ Node èŠ‚ç‚¹ä¸Š</li>
<li>nodeSelector &lt;map[]&gt; æ ¹æ®NodeSelectorä¸­å®šä¹‰çš„ä¿¡æ¯é€‰æ‹©å°†è¯¥ Pod è°ƒåº¦åˆ°åŒ…å«è¿™äº› label çš„ Node ä¸Š</li>
<li>hostNetwork æ˜¯å¦ä½¿ç”¨ä¸»æœºç½‘ç»œæ¨¡å¼ï¼Œé»˜è®¤ä¸º falseï¼Œå¦‚æœè®¾ç½®ä¸º trueï¼Œè¡¨ç¤ºä½¿ç”¨å®¿ä¸»æœºç½‘ç»œ</li>
<li>volumes &lt;[]Object&gt; å­˜å‚¨å·ï¼Œç”¨äºå®šä¹‰ Pod ä¸Šé¢æŒ‚åœ¨çš„å­˜å‚¨ä¿¡æ¯</li>
<li>restartPolicy é‡å¯ç­–ç•¥ï¼Œè¡¨ç¤º Pod åœ¨é‡åˆ°æ•…éšœçš„æ—¶å€™çš„å¤„ç†ç­–ç•¥</li>
</ul>
</blockquote>
<h3 id="2-å®ç°podæ–‡ä»¶å¤šå®¹å™¨è¿è¡Œ">2) å®ç°Podæ–‡ä»¶å¤šå®¹å™¨è¿è¡Œ</h3>
<p>åˆ›å»ºpod-base.ymlæ–‡ä»¶,å†…å®¹å¦‚ä¸‹:</p>
<pre><code class="language-yml">apiVersion: v1
kind: Deployment
metadata: 
	name: pod-base
	labels: 
	  school: heima
spec:
  replicas: 2
  selector:
    matchLabels:
      school: heima
	template:
    metadata:
      labels:
        school: heima
    spec:
      containers:
      - name: nginx
      	image: nginx:latest
      	ports: 
        - containerPort: 80
      - name: busybox
      	image: busybox:1.30
        command: [&quot;/bin/sh&quot;,&quot;-c&quot;,&quot;touch /tmp/hello.txt;while true;do /bin/echo $(date +%T) &gt;&gt; /tmp/hello.txt; sleep 3; done;&quot;]

</code></pre>
<pre><code class="language-shell">kc apply -f pod-base.yml

# ç»“æœ
[root@master ~]# kc get pods
NAME                        READY   STATUS    RESTARTS   AGE
pod-base-86dcff97c4-b6zlz   2/2     Running   0          2m23s
pod-base-86dcff97c4-g8jsm   2/2     Running   0          2m23s
</code></pre>
<p><strong>æ³¨æ„:</strong> å› ä¸ºbusyboxæ˜¯æ— åå°è¿›ç¨‹çš„å®¹å™¨,æ‰€ä»¥æˆ‘ä»¬å¿…é¡»åŠ ä¸Šcommand,è®©åå°æœ‰ç¨‹åºè¿è¡Œ,å¦åˆ™å®¹å™¨ä¼šè‡ªåŠ¨å…³é—­.</p>
<h3 id="3-ç¯å¢ƒå˜é‡">3) ç¯å¢ƒå˜é‡</h3>
<pre><code class="language-yml">apiVersion: v1
kind: Pod
metadata:
  name: pod-env
  namespace: dev
spec:
  containers:
  - name: busybox
    image: busybox:1.30
    command: [&quot;/bin/sh&quot;,&quot;-c&quot;,&quot;while true;do /bin/echo $(date +%T);sleep 60; done;&quot;]
    env: # è®¾ç½®ç¯å¢ƒå˜é‡åˆ—è¡¨
    - name: &quot;username&quot;
      value: &quot;admin&quot;
    - name: &quot;password&quot;
      value: &quot;123456&quot;
</code></pre>
<p>env ç¯å¢ƒå˜é‡ï¼Œç”¨äºåœ¨podä¸­çš„å®¹å™¨è®¾ç½®ç¯å¢ƒå˜é‡ã€‚</p>
<pre><code class="language-shell"># åˆ›å»ºPod
[root@k8s-master01 ~]# kubectl create -f pod-env.yaml
pod/pod-env created

# è¿›å…¥å®¹å™¨ï¼Œè¾“å‡ºç¯å¢ƒå˜é‡
[root@k8s-master01 ~]# kubectl exec pod-env -n dev -c busybox -it /bin/sh
/ # echo $username
admin
/ # echo $password
123456
</code></pre>
<p>æç¤ºï¼šè¿™ç§æ–¹å¼ä¸æ˜¯å¾ˆæ¨èï¼Œæ¨èå°†è¿™äº›é…ç½®å•ç‹¬å­˜å‚¨åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œè¿™ç§æ–¹å¼å°†åœ¨åé¢ä»‹ç»ã€‚</p>
<h3 id="4-ç«¯å£è®¾ç½®">4) ç«¯å£è®¾ç½®</h3>
<p>é¦–å…ˆçœ‹ä¸‹portsæ”¯æŒçš„å­é€‰é¡¹ï¼š</p>
<pre><code class="language-shell">$# kubectl explain pod.spec.containers.ports
KIND:     Pod
VERSION:  v1
RESOURCE: ports &lt;[]Object&gt;
FIELDS:
   name         &lt;string&gt;  # ç«¯å£åç§°ï¼Œå¦‚æœæŒ‡å®šï¼Œå¿…é¡»ä¿è¯nameåœ¨podä¸­æ˜¯å”¯ä¸€çš„     
   containerPort&lt;integer&gt; # å®¹å™¨è¦ç›‘å¬çš„ç«¯å£(0&lt;x&lt;65536)
   hostPort     &lt;integer&gt; # å®¹å™¨è¦åœ¨ä¸»æœºä¸Šå…¬å¼€çš„ç«¯å£ï¼Œå¦‚æœè®¾ç½®ï¼Œä¸»æœºä¸Šåªèƒ½è¿è¡Œå®¹å™¨çš„ä¸€ä¸ªå‰¯æœ¬(ä¸€èˆ¬çœç•¥) 
   hostIP       &lt;string&gt;  # è¦å°†å¤–éƒ¨ç«¯å£ç»‘å®šåˆ°çš„ä¸»æœºIP(ä¸€èˆ¬çœç•¥)
   protocol     &lt;string&gt;  # ç«¯å£åè®®ã€‚å¿…é¡»æ˜¯UDPã€TCPæˆ–SCTPã€‚é»˜è®¤ä¸ºâ€œTCPâ€ã€‚
</code></pre>
<p>æ¥ä¸‹æ¥ï¼Œç¼–å†™ä¸€ä¸ªæµ‹è¯•æ¡ˆä¾‹ï¼Œåˆ›å»ºpod-ports.yaml</p>
<pre><code class="language-yml">apiVersion: v1
kind: Pod
metadata:
  name: pod-ports
  namespace: dev
spec:
  containers:
  - name: nginx
    image: nginx:1.17.1
    ports: XX                  # è®¾ç½®å®¹å™¨æš´éœ²çš„ç«¯å£åˆ—è¡¨
    - name: nginx-port
      containerPort: 80
      protocol: TCP
</code></pre>
<pre><code class="language-shell"># åˆ›å»ºPod
[root@k8s-master01 ~]# kubectl create -f pod-ports.yaml
pod/pod-ports created

# æŸ¥çœ‹pod
# åœ¨ä¸‹é¢å¯ä»¥æ˜æ˜¾çœ‹åˆ°é…ç½®ä¿¡æ¯
[root@k8s-master01 ~]# kubectl get pod pod-ports -n dev -o yaml
......
spec:
  containers:
  - image: nginx:1.17.1
    imagePullPolicy: IfNotPresent
    name: nginx
    ports:
    - containerPort: 80
      name: nginx-port
      protocol: TCP
......
</code></pre>
<h3 id="5-é•œåƒæ‹‰å–ç­–ç•¥">5) é•œåƒæ‹‰å–ç­–ç•¥</h3>
<blockquote>
<p>imagePullPolicy,ç”¨äºè®¾ç½®é•œåƒæ‹‰å–ç­–ç•¥,Kubenetesæ”¯æŒä¸‰ç§æ‹‰å–ç­–ç•¥</p>
<p>â€‹	Always: æ€»æ˜¯ä»è¿œç¨‹ä»“åº“æ‹‰å–é•œåƒ</p>
<p>â€‹	IfNotPresent: æœ¬åœ°æœ‰åˆ™ä½¿ç”¨æœ¬åœ°çš„,æœ¬åœ°æ²¡æœ‰åˆ™æ‹‰å–è¿œç¨‹çš„</p>
<p>â€‹	Never: åªä½¿ç”¨æœ¬åœ°é•œåƒ,ä»ä¸å»è¿œç¨‹ä»“åº“æ‹‰å–</p>
<p>é»˜è®¤ç­–ç•¥(ä¸é…ç½®imagePullPolicyå­—æ®µ):</p>
<p>â€‹	å¦‚æœé•œåƒç‰ˆæœ¬æ˜¯å…·ä½“ç‰ˆæœ¬å·å¦‚1.13.0 ,åˆ™é»˜è®¤ç­–ç•¥æ˜¯IfNotPresent</p>
<p>â€‹	å¦‚æœé•œåƒç‰ˆæœ¬æ˜¯latest,åˆ™é»˜è®¤ç­–ç•¥æ˜¯Always</p>
</blockquote>
<pre><code class="language-yml">apiVersion: v1
kind: Pod
metadata:
  name: pod-env
  namespace: dev
spec:
  containers:
  - name: busybox
    image: busybox:1.30
    imagePullPolicy: Always  # ç”¨äºè®¾ç½®æ‹‰å–é•œåƒç­–ç•¥
</code></pre>
<h2 id="ç–‘é—®">ç–‘é—®:</h2>
<p>é€šè¿‡ymlåˆ›å»ºsvc,ä¸èƒ½å®ç°ipç«¯å£æ˜ å°„æ— æ³•è®¿é—®æœåŠ¡,é—®é¢˜å¦‚ä¸‹</p>
<figure data-type="image" tabindex="2"><img src="http://ggcodec.github.io/post-images/1677345781508.png" alt="" loading="lazy"></figure>
<h2 id=""></h2>

            </div>
            
              <div class="tag-container">
                
                  <a href="http://ggcodec.github.io/tag/M-LooU-zH/" class="tag">
                    è¿ç»´
                  </a>
                
              </div>
            
            
              <div class="next-post">
                <div class="next">ä¸‹ä¸€ç¯‡</div>
                <a href="http://ggcodec.github.io/post/hello-gridea/">
                  <h3 class="post-title">
                    Hello Gridea
                  </h3>
                </a>
              </div>
            

            
              
                <div id="gitalk-container" data-aos="fade-in"></div>
              

              
            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>


  <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.5.1/build/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad()
  </script>




  
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>

      var gitalk = new Gitalk({
        clientID: '875a5364c81efb07e64c',
        clientSecret: '7c0bc3d86f9f58dd098174b18d0c652a1f1e72c4',
        repo: 'ggcodec.github.io',
        owner: 'ggcodec',
        admin: ['ggcodec'],
        id: (location.pathname).substring(0, 49),      // Ensure uniqueness and length less than 50
        distractionFreeMode: false  // Facebook-like distraction free mode
      })

      gitalk.render('gitalk-container')

    </script>
  

  




  </body>
</html>
